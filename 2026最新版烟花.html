<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨å±ç‚«å½©çƒŸèŠ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            color: white;
            min-height: 100vh;
        }
        
        h1 {
            color: #ffcc00;
            text-align: center;
            position: fixed;
            top: 20px;
            left: 0;
            width: 100%;
            z-index: 10;
            pointer-events: none;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 1;
            cursor: crosshair;
        }
        
        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: fixed;
            top: 0;
            right: -280px;
            width: 280px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 20;
            padding: 12px;
            border-left: 1px solid rgba(255, 204, 0, 0.3);
            transition: transform 0.3s ease;
            overflow-y: auto;
        }
        
        .sidebar.active {
            transform: translateX(-280px);
        }
        
        /* ä¾§è¾¹æ é®ç½© */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 19;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        /* åº•éƒ¨æ§åˆ¶æŒ‰é’® */
        .toggle-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 30;
            background: rgba(0, 0, 0, 0.7);
            color: #ffcc00;
            border: 1px solid #ffcc00;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .toggle-panel.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .toggle-panel:hover {
            background: rgba(255, 204, 0, 0.2);
            transform: scale(1.1);
        }
        
        .clear-screen-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 30;
            background: linear-gradient(to right, #ff3333, #ff6666);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 51, 51, 0.4);
            transition: all 0.3s;
        }
        
        .clear-screen-btn.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .clear-screen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 51, 51, 0.6);
        }
        
        .auto-mode-indicator {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10;
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid #00ff00;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        /* ä¾§è¾¹æ å†…éƒ¨å¸ƒå±€ */
        .sidebar-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-group {
            background: rgba(30, 30, 30, 0.7);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 204, 0, 0.2);
        }
        
        .control-group h3 {
            color: #ffcc00;
            margin-bottom: 10px;
            text-align: center;
            font-size: 16px;
        }
        
        input, button, select, textarea {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 8px;
        }
        
        input, textarea {
            background: #222;
            color: white;
            border: 1px solid #444;
            font-size: 12px;
        }
        
        button {
            background: linear-gradient(to right, #ff9900, #ffcc00);
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .auto-mode-btn {
            background: linear-gradient(to right, #00aa00, #00cc00);
        }
        
        .stop-auto-mode-btn {
            background: linear-gradient(to right, #ff3333, #ff6666);
        }
        
        /* çƒŸèŠ±ç±»å‹æ§åˆ¶ */
        .firework-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .firework-control {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        .firework-control label {
            font-size: 12px;
            cursor: pointer;
            flex-grow: 1;
        }
        
        .firework-control input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin: 0;
        }
        
        /* æ§åˆ¶ç»„è¯´æ˜æ–‡å­— */
        .control-description {
            font-size: 11px;
            color: #aaa;
            margin-top: 8px;
            text-align: center;
            line-height: 1.4;
        }
        
        /* æ–‡å­—æ˜¾ç¤ºæ¨¡å¼æŒ‰é’®ç»„ */
        .text-display-mode {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .text-display-btn {
            flex: 1;
            padding: 8px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .text-display-btn.active {
            background: linear-gradient(to right, #ff9900, #ffcc00);
            color: #000;
            font-weight: bold;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .sidebar {
                width: 260px;
                right: -260px;
            }
            
            .sidebar.active {
                transform: translateX(-260px);
            }
            
            .toggle-panel {
                bottom: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .clear-screen-btn {
                bottom: 10px;
                left: 10px;
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .auto-mode-indicator {
                top: 70px;
                right: 10px;
                font-size: 12px;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <h1>ğŸ‡¨ğŸ‡³ 2026å¹´   ğŸå¹´å‰ç¥¥ ğŸ‡¨ğŸ‡³</h1>
    
    <!-- è‡ªåŠ¨æ¨¡å¼æŒ‡ç¤ºå™¨ -->
    <div class="auto-mode-indicator" id="autoModeIndicator">â€œä¸‰ä¸ªå­—â€åˆ¶ä½œ/éƒ¨ç½²</div>
    
    <canvas id="canvas"></canvas>
    
    <!-- æ¸…å±æŒ‰é’® -->
    <button class="clear-screen-btn" id="clearScreenBtn">æ¸…å±</button>
    
    <!-- ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® -->
    <div class="toggle-panel" id="togglePanel">âš™</div>
    
    <!-- ä¾§è¾¹æ é®ç½© -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- ä¾§è¾¹æ æ§åˆ¶é¢æ¿ -->
    <div class="sidebar" id="sidebarPanel">
        <div class="sidebar-content">
            <!-- è‡ªå®šä¹‰ç¥ç¦è¯­ -->
            <div class="control-group">
                <h3>è‡ªå®šä¹‰</h3>
                <textarea id="customText" placeholder="è¾“å…¥æ‚¨çš„ç¥ç¦è¯­ï¼Œå¤šä¸ªç¥ç¦è¯­ç”¨é€—å·åˆ†éš”..." rows="4"></textarea>
                <button id="updateTextBtn">ç¡®è®¤ä¿®æ”¹</button>
                <div class="text-display-mode">
                    <button id="randomDisplayBtn" class="text-display-btn active">éšæœºæ”¾</button>
                    <button id="sequentialDisplayBtn" class="text-display-btn">é¡ºåºæ”¾</button>
                </div>
                <p class="control-description">
                    è¾“å…¥å¤šä¸ªç¥ç¦è¯­æ—¶ï¼Œè¯·ç”¨è‹±æ–‡é€—å·(,)åˆ†éš”<br>
                    æ¸…ç©ºè¾“å…¥æ¡†çƒŸèŠ±å°†ä¸ä¼šæ˜¾ç¤ºä»»ä½•æ–‡å­—
                </p>
            </div>
            
            <!-- çƒŸèŠ±ç±»å‹æ§åˆ¶ -->
            <div class="control-group">
                <h3>çƒŸèŠ±ç±»å‹è®¾ç½®</h3>
                <div class="firework-controls">
                    <div class="firework-control">
                        <input type="checkbox" id="normalFirework" checked>
                        <label for="normalFirework">æ™®é€šçƒŸèŠ±</label>
                    </div>
                    <div class="firework-control">
                        <input type="checkbox" id="sparkleFirework" checked>
                        <label for="sparkleFirework">é—ªçƒçƒŸèŠ±</label>
                    </div>
                    <div class="firework-control">
                        <input type="checkbox" id="rainFirework" checked>
                        <label for="rainFirework">ä¸‹é›¨çƒŸèŠ±</label>
                    </div>
                    <div class="firework-control">
                        <input type="checkbox" id="rainSparkleFirework" checked>
                        <label for="rainSparkleFirework">ä¸‹é›¨é—ªçƒ</label>
                    </div>
                </div>
                <p class="control-description">
                    è‡³å°‘éœ€è¦é€‰æ‹©ä¸€ç§çƒŸèŠ±ç±»å‹<br>
                    ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç”ŸæˆçƒŸèŠ±
                </p>
            </div>
            
            <!-- è‡ªåŠ¨æ¨¡å¼æ§åˆ¶ -->
            <div class="control-group">
                <h3>è‡ªåŠ¨æ¨¡å¼æ§åˆ¶</h3>
                <button id="autoModeBtn" class="stop-auto-mode-btn">åœæ­¢è‡ªåŠ¨æ¨¡å¼</button>
                <p class="control-description">
                    è‡ªåŠ¨æ¨¡å¼ä¸‹ï¼Œå››ç§çƒŸèŠ±å°†æŒ‰15%-25%çš„éšæœºæ¦‚ç‡å‡ºç°ã€‚å…³é—­è‡ªåŠ¨æ¨¡å¼åä»å¯æ‰‹åŠ¨ç‚¹å‡»å±
                    ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚å¹•ç”ŸæˆçƒŸèŠ±ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>
                    
                </p>
            </div>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <div class="control-group">
                <h3>ä½¿ç”¨è¯´æ˜</h3>
                <ul style="font-size: 12px; color: #aaa; padding-left: 18px;">
                    <li>â™¤ç‚¹å‡»ä¾§è¾¹æ å¤–å¯å…³é—­ä¾§è¾¹æ </li>
                    <li>â™¡ç‚¹å‡»å±å¹•ä»»æ„ä½ç½®ç”ŸæˆçƒŸèŠ±</li>
                    <li>â™§æ‰€æœ‰ä»£ç éƒ½æ˜¯å¼€æºã€S_G_Zã€‘</li>
                    <li>â™¢æ¬¢è¿å„ç§åˆ†äº«å¥½å‹ã€ä¸‰ä¸ªå­—ã€‘</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // è·å–Canvaså…ƒç´ å’Œä¸Šä¸‹æ–‡
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // è®¾ç½®Canvaså°ºå¯¸ä¸ºå…¨å±
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        
        // åˆå§‹è®¾ç½®Canvaså°ºå¯¸
        resizeCanvas();
        
        // é»˜è®¤ç¥ç¦è¯­åˆ—è¡¨
        const defaultBlessings = [
            "æ–°å¹´å¿«ä¹", "æ­å–œå‘è´¢", "ä¸‡äº‹å¦‚æ„", "å¿ƒæƒ³äº‹æˆ",
            "å‰ç¥¥å¦‚æ„", "ç¦æ˜Ÿé«˜ç…§", "ç¬‘å£å¸¸å¼€", "å¤§å‰å¤§åˆ©",
            "ä¸€å¸†é£é¡º", "äºŒé¾™è…¾é£", "ä¸‰é˜³å¼€æ³°", "å››å­£å¹³å®‰",
            "äº”ç¦ä¸´é—¨", "å…­å…­å¤§é¡º", "ä¸ƒæ˜Ÿé«˜ç…§", "å…«æ–¹æ¥è´¢",
            "ä¹ä¹åŒå¿ƒ", "åå…¨åç¾"
        ];
        
        // è‡ªå®šä¹‰æ–‡æœ¬åˆ—è¡¨
        let customTexts = [...defaultBlessings];
        // å½“å‰ç¥ç¦è¯­ç´¢å¼•ï¼ˆç”¨äºé¡ºåºæ’­æ”¾ï¼‰
        let currentTextIndex = 0;
        // ç¥ç¦è¯­æ˜¾ç¤ºæ¨¡å¼ï¼š'random'æˆ–'sequential'
        let textDisplayMode = 'random';
        
        // çƒŸèŠ±æ•°ç»„
        let fireworks = [];
        // ç²’å­æ•°ç»„
        let particles = [];
        // æ–‡æœ¬æ•ˆæœæ•°ç»„
        let texts = [];
        
        // è‡ªåŠ¨æ¨¡å¼çŠ¶æ€ - é»˜è®¤å¼€å¯
        let autoMode = true;
        let autoInterval;
        
        // ä¾§è¾¹æ çŠ¶æ€
        let panelVisible = false;
        
        // çƒŸèŠ±ç±»å‹è®¾ç½®
        let fireworkSettings = {
            normal: true,
            sparkle: true,
            rain: true,
            rainSparkle: true
        };
        
        // éšæœºæ•°ç”Ÿæˆå‡½æ•°
        function random(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        // éšæœºæ•´æ•°ç”Ÿæˆå‡½æ•°
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // éšæœºé¢œè‰²ç”Ÿæˆå‡½æ•°
        function getRandomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        // ç”Ÿæˆå¤šä¸ªéšæœºé¢œè‰²
        function getRandomColors(count) {
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(getRandomColor());
            }
            return colors;
        }
        
        // ç¡®ä¿ä½ç½®åœ¨å±å¹•èŒƒå›´å†…çš„å‡½æ•°
        function ensureInScreen(x, y) {
            const margin = 50;
            return {
                x: Math.max(margin, Math.min(canvas.width - margin, x)),
                y: Math.max(margin, Math.min(canvas.height - margin, y))
            };
        }
        
        // è·å–å¯ç”¨çš„çƒŸèŠ±ç±»å‹
        function getAvailableFireworkTypes() {
            const types = [];
            if (fireworkSettings.normal) types.push('normal');
            if (fireworkSettings.sparkle) types.push('sparkle');
            if (fireworkSettings.rain) types.push('rain');
            if (fireworkSettings.rainSparkle) types.push('rainSparkle');
            
            // ç¡®ä¿è‡³å°‘æœ‰ä¸€ç§çƒŸèŠ±ç±»å‹è¢«é€‰ä¸­
            if (types.length === 0) {
                types.push('normal');
                fireworkSettings.normal = true;
                document.getElementById('normalFirework').checked = true;
            }
            
            return types;
        }
        
        // éšæœºé€‰æ‹©çƒŸèŠ±ç±»å‹
        function getRandomFireworkType() {
            const availableTypes = getAvailableFireworkTypes();
            return availableTypes[Math.floor(Math.random() * availableTypes.length)];
        }
        
        // æ›´æ–°ç¥ç¦è¯­åˆ—è¡¨
        function updateBlessings() {
            const textInput = document.getElementById('customText');
            const text = textInput.value.trim();
            
            if (text) {
                customTexts = text.split(',').map(t => t.trim()).filter(t => t.length > 0);
                
                if (customTexts.length === 0) {
                    alert('å·²æ¸…ç©ºç¥ç¦è¯­åˆ—è¡¨ï¼ŒçƒŸèŠ±å°†ä¸ä¼šæ˜¾ç¤ºæ–‡å­—');
                } else {
                    alert(`å·²æ›´æ–°ç¥ç¦è¯­åˆ—è¡¨ï¼Œå…± ${customTexts.length} æ¡ç¥ç¦è¯­`);
                }
            } else {
                customTexts = [];
                alert('å·²æ¸…ç©ºç¥ç¦è¯­åˆ—è¡¨ï¼ŒçƒŸèŠ±å°†ä¸ä¼šæ˜¾ç¤ºæ–‡å­—');
            }
            
            currentTextIndex = 0;
        }
        
        // è®¾ç½®æ–‡å­—æ˜¾ç¤ºæ¨¡å¼
        function setTextDisplayMode(mode) {
            textDisplayMode = mode;
            
            document.getElementById('randomDisplayBtn').classList.toggle('active', mode === 'random');
            document.getElementById('sequentialDisplayBtn').classList.toggle('active', mode === 'sequential');
            
            if (mode === 'sequential') {
                currentTextIndex = 0;
            }
        }
        
        // åˆ‡æ¢ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€
        function toggleSidebar() {
            panelVisible = !panelVisible;
            
            const sidebar = document.getElementById('sidebarPanel');
            const overlay = document.getElementById('sidebarOverlay');
            const toggleBtn = document.getElementById('togglePanel');
            const clearBtn = document.getElementById('clearScreenBtn');
            
            if (panelVisible) {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                toggleBtn.classList.add('hidden');
                clearBtn.classList.add('hidden');
            } else {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
                toggleBtn.classList.remove('hidden');
                clearBtn.classList.remove('hidden');
            }
        }
        
        // çƒŸèŠ±åŸºç±»
        class Firework {
            constructor(x, y, type = 'normal') {
                const safePos = ensureInScreen(x, y);
                this.x = safePos.x;
                this.y = safePos.y;
                this.type = type;
                
                this.sx = this.x;
                this.sy = canvas.height;
                
                this.radius = 2.5;
                this.colors = getRandomColors(10);
                this.mainColor = this.colors[0];
                this.speed = random(15, 20);
                
                this.angle = Math.atan2(this.y - this.sy, this.x - this.sx);
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                
                this.gravity = 0.02;
                this.exploded = false;
                this.reachedTarget = false;
            }
            
            update() {
                if (!this.reachedTarget) {
                    this.sx += this.vx;
                    this.sy += this.vy;
                    this.vy += this.gravity;
                    
                    const dx = this.x - this.sx;
                    const dy = this.y - this.sy;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 10 || this.sy <= this.y) {
                        this.reachedTarget = true;
                        this.explode();
                    }
                }
            }
            
            explode() {
                this.exploded = true;
                
                const safeX = Math.max(0, Math.min(canvas.width, this.sx));
                const safeY = Math.max(0, Math.min(canvas.height, this.sy));
                this.sx = safeX;
                this.sy = safeY;
                
                this.createParticles();
                
                if (customTexts.length > 0) {
                    this.showText();
                }
            }
            
            createParticles() {
                const particleCount = randomInt(80, 180);
                
                switch(this.type) {
                    case 'sparkle':
                        for (let i = 0; i < particleCount; i++) {
                            particles.push(new SparkleParticle(this.sx, this.sy, getRandomColor()));
                        }
                        break;
                        
                    case 'rain':
                        for (let i = 0; i < particleCount; i++) {
                            particles.push(new RainParticle(this.sx, this.sy, getRandomColor(), false));
                        }
                        break;
                        
                    case 'rainSparkle':
                        for (let i = 0; i < particleCount; i++) {
                            particles.push(new SparkleRainParticle(this.sx, this.sy, getRandomColor()));
                        }
                        break;
                        
                    default:
                        for (let i = 0; i < particleCount; i++) {
                            particles.push(new Particle(this.sx, this.sy, getRandomColor(), false));
                        }
                }
            }
            
            showText() {
                let text;
                if (textDisplayMode === 'random') {
                    text = customTexts[Math.floor(Math.random() * customTexts.length)];
                } else {
                    text = customTexts[currentTextIndex];
                    currentTextIndex = (currentTextIndex + 1) % customTexts.length;
                }
                
                texts.push(new TextEffect(this.sx, this.sy, text, getRandomColors(20)));
            }
            
            draw() {
                if (!this.reachedTarget) {
                    ctx.beginPath();
                    ctx.arc(this.sx, this.sy, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.mainColor;
                    ctx.fill();
                }
            }
        }
        
        // æ™®é€šç²’å­ç±»
        class Particle {
            constructor(x, y, color, flicker = false) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.radius = random(1.0, 2.5);
                this.speed = random(3, 8);
                this.angle = random(0, Math.PI * 2);
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.gravity = 0.05;
                this.resistance = 0.97;
                this.alpha = 1;
                this.decay = random(0.005, 0.015);
                this.flicker = flicker;
                this.flickerValue = 0;
                this.lifetime = 0;
            }
            
            update() {
                this.lifetime++;
                
                this.vx *= this.resistance;
                this.vy *= this.resistance;
                this.vy += this.gravity;
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.alpha -= this.decay;
                
                if (this.flicker) {
                    this.flickerValue = Math.sin(Date.now() * 0.02) * 0.5 + 0.5;
                }
                
                return this.alpha > 0;
            }
            
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                
                if (this.flicker) {
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = this.alpha * this.flickerValue;
                } else {
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = this.alpha;
                }
                
                ctx.fill();
            }
        }
        
        // é—ªçƒç²’å­ç±»
        class SparkleParticle extends Particle {
            constructor(x, y, color) {
                super(x, y, color, true);
                this.sparkleIntensity = random(0.7, 1.0);
                this.sparkleSpeed = random(0.1, 0.2);
            }
            
            update() {
                this.lifetime++;
                
                this.vx *= this.resistance;
                this.vy *= this.resistance;
                this.vy += this.gravity;
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.alpha -= this.decay;
                
                this.flickerValue = Math.sin(this.lifetime * this.sparkleSpeed) * this.sparkleIntensity + (1 - this.sparkleIntensity/2);
                
                return this.alpha > 0;
            }
        }
        
        // ä¸‹é›¨ç²’å­ç±»
        class RainParticle extends Particle {
            constructor(x, y, color, flicker = false) {
                super(x, y, color, flicker);
                this.angle = random(0, Math.PI * 2);
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.gravity = 0.05;
                this.initialPhase = true;
                this.explosionDuration = random(15, 30);
            }
            
            update() {
                this.lifetime++;
                
                if (this.lifetime < this.explosionDuration) {
                    this.vx *= this.resistance;
                    this.vy *= this.resistance;
                } else {
                    if (this.initialPhase) {
                        this.vx = 0;
                        this.vy = Math.abs(this.vy) * 0.75;
                        this.initialPhase = false;
                    }
                    this.vy += this.gravity;
                }
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.alpha -= this.decay;
                
                if (this.flicker) {
                    this.flickerValue = Math.sin(Date.now() * 0.02) * 0.5 + 0.5;
                }
                
                return this.alpha > 0;
            }
        }
        
        // ä¸‹é›¨é—ªçƒç²’å­ç±»
        class SparkleRainParticle extends RainParticle {
            constructor(x, y, color) {
                super(x, y, color, true);
                this.sparkleIntensity = random(0.7, 1.0);
                this.sparkleSpeed = random(0.1, 0.2);
            }
            
            update() {
                this.lifetime++;
                
                if (this.lifetime < this.explosionDuration) {
                    this.vx *= this.resistance;
                    this.vy *= this.resistance;
                } else {
                    if (this.initialPhase) {
                        this.vx = 0;
                        this.vy = Math.abs(this.vy) * 0.75;
                        this.initialPhase = false;
                    }
                    this.vy += this.gravity;
                }
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.alpha -= this.decay;
                
                this.flickerValue = Math.sin(this.lifetime * this.sparkleSpeed) * this.sparkleIntensity + (1 - this.sparkleIntensity/2);
                
                return this.alpha > 0;
            }
        }
        
        // æ–‡æœ¬æ•ˆæœç±»
        class TextEffect {
            constructor(x, y, text, colors) {
                this.x = x;
                this.y = y;
                this.text = text;
                this.size = randomInt(24, 48);
                this.colors = colors;
                this.currentColorIndex = 0;
                this.alpha = 1;
                this.vy = -1.5;
                this.decay = 0.008;
                this.colorChangeInterval = 0;
            }
            
            update() {
                this.y += this.vy;
                this.alpha -= this.decay;
                
                this.colorChangeInterval++;
                if (this.colorChangeInterval > 5) {
                    this.currentColorIndex = (this.currentColorIndex + 1) % this.colors.length;
                    this.colorChangeInterval = 0;
                }
                
                return this.alpha > 0;
            }
            
            draw() {
                const currentColor = this.colors[this.currentColorIndex];
                
                ctx.font = `bold ${this.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = currentColor;
                ctx.globalAlpha = this.alpha;
                ctx.fillText(this.text, this.x, this.y);
                ctx.globalAlpha = 1;
            }
        }
        
        // åˆ›å»ºæ–°çƒŸèŠ±
        function createFirework(x, y, type = null) {
            if (!type) {
                type = getRandomFireworkType();
            }
            fireworks.push(new Firework(x, y, type));
        }
        
        // å¯åŠ¨è‡ªåŠ¨æ¨¡å¼
        function startAutoMode() {
            if (!autoMode) {
                autoMode = true;
                document.getElementById('autoModeIndicator').style.display = 'block';
                document.getElementById('autoModeBtn').textContent = 'åœæ­¢è‡ªåŠ¨æ¨¡å¼';
                document.getElementById('autoModeBtn').className = 'stop-auto-mode-btn';
            }
            
            autoInterval = setInterval(function() {
                const x = random(canvas.width * 0.1, canvas.width * 0.9);
                const y = random(canvas.height * 0.1, canvas.height * 0.5);
                createFirework(x, y);
            }, 800);
        }
        
        // åœæ­¢è‡ªåŠ¨æ¨¡å¼
        function stopAutoMode() {
            if (autoMode) {
                autoMode = false;
                clearInterval(autoInterval);
                document.getElementById('autoModeIndicator').style.display = 'none';
                document.getElementById('autoModeBtn').textContent = 'å¼€å¯è‡ªåŠ¨æ¨¡å¼';
                document.getElementById('autoModeBtn').className = 'auto-mode-btn';
            }
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            for (let i = fireworks.length - 1; i >= 0; i--) {
                fireworks[i].update();
                fireworks[i].draw();
                
                if (fireworks[i].exploded) {
                    fireworks.splice(i, 1);
                }
            }
            
            for (let i = particles.length - 1; i >= 0; i--) {
                if (!particles[i].update()) {
                    particles.splice(i, 1);
                } else {
                    particles[i].draw();
                }
            }
            
            for (let i = texts.length - 1; i >= 0; i--) {
                if (!texts[i].update()) {
                    texts.splice(i, 1);
                } else {
                    texts[i].draw();
                }
            }
            
            requestAnimationFrame(animate);
        }
        
        // åˆå§‹åŒ–çƒŸèŠ±ç±»å‹è®¾ç½®
        function initFireworkSettings() {
            const checkboxes = document.querySelectorAll('.firework-control input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const type = this.id.replace('Firework', '');
                    fireworkSettings[type] = this.checked;
                    
                    const availableTypes = getAvailableFireworkTypes();
                    if (availableTypes.length === 0) {
                        this.checked = true;
                        fireworkSettings[type] = true;
                        alert('å¿…é¡»è‡³å°‘ä¿ç•™ä¸€ç§çƒŸèŠ±ç±»å‹ï¼');
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–
        function init() {
            initFireworkSettings();
            animate();
            startAutoMode();
            
            // åˆå§‹åŒ–è¾“å…¥æ¡†å†…å®¹
            document.getElementById('customText').value = defaultBlessings.join(', ');
            
            // äº‹ä»¶ç›‘å¬
            canvas.addEventListener('click', function(e) {
                createFirework(e.clientX, e.clientY);
            });
            
            document.getElementById('clearScreenBtn').addEventListener('click', function() {
                fireworks = [];
                particles = [];
                texts = [];
            });
            
            document.getElementById('togglePanel').addEventListener('click', toggleSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', toggleSidebar);
            document.getElementById('updateTextBtn').addEventListener('click', updateBlessings);
            document.getElementById('autoModeBtn').addEventListener('click', function() {
                if (autoMode) stopAutoMode();
                else startAutoMode();
            });
            
            // æ–‡å­—æ˜¾ç¤ºæ¨¡å¼æŒ‰é’®
            document.getElementById('randomDisplayBtn').addEventListener('click', function() {
                setTextDisplayMode('random');
            });
            
            document.getElementById('sequentialDisplayBtn').addEventListener('click', function() {
                setTextDisplayMode('sequential');
            });
            
            // åˆå§‹è®¾ç½®æ˜¾ç¤ºæ¨¡å¼ä¸ºéšæœº
            setTextDisplayMode('random');
            
            // åˆå§‹çƒŸèŠ±æ•ˆæœ
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const x = random(canvas.width * 0.1, canvas.width * 0.9);
                    const y = random(canvas.height * 0.1, canvas.height * 0.5);
                    createFirework(x, y);
                }, i * 1000);
            }
        }
        
        window.addEventListener('load', init);
        window.addEventListener('resize', resizeCanvas);
    </script>
</body>
</html>
